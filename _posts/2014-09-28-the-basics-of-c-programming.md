---
layout: post
title: "C 编程基础"
description: ""
category: [C]
---

#### 在[howstuffworks][1]网站发现了一篇非常好的介绍 [C 编程基础的文章][2]，图文并茂，深入浅出，于是将其翻译过来，同时巩固一下 C 基础知识。

## C 编程基础介绍

#### C 编程语言是用来创建计算机程序的流行的被广泛应用的语言。由于其提供了最大的控制能力和高效的灵活性深受广大程序员热爱。

#### 如果你是一名程序员，或者你有志于成为一名程序员，学习 C 编程语言可以带来很多好处：
- 我们可以阅读和编写为各种不同的平台编写的代码 —— 从微控制器到高级科学计算系统，乃至各种现代操作系统。
- 为以后学习 C++ 等面向对象编程语言打好基础。C++ 从 C 的超集发展而来，很多语法和 C 都是兼容的。（译者注：原文中提到基本不可能在不学习 C 的前提下学习 C++ 语言，我觉得这个论断现在已经不合适了。） 

#### 在这篇文章中，我们将一一学习 C 语言的知识点，并且讲述如何入门 C 语言编程。在掌握 C 语言之后，你会为你所能做的事情而惊讶的。

##### 一个 C 程序的运行示意图
![一个 C 程序的运行示意图][c-exec]

## 什么是 C ？

#### C 是一中计算机编程语言。这意味着我们可以使用 C 语言创建一系列计算机可以照做的指令。C 语言只是现在数以千计的编程语言的一种，而且 C 语言已经存在了半个多世纪并一直备受器重，原因就在于它所提供的强大的控制力和灵活性。 C 不难学习，相对于其他语言可能在形式上有一点点传统，但是我们会很快适应的。

#### C 是所谓的编译型语言。这意味着在我们创建一个 C 应用程序的时候，我们需要使用一个 C 编译器将 C 源码编译为计算机可以运行的可执行文件。C 语言源码是容易阅读的，然而编译后的可执行二进制码是机器友好的。这意味着如果要编写并运行一个 C 应用程序，我们需要拥有一个 C 编译器。如果我们在 Unix 平台上，该平台自带免费的 C 编译器，名字为 “cc” 或者 “gcc”，而且提供了命令行支持。如果我们在 Windows 平台上，那我们需要下载一个免费的 C 编译器或者购买一个商业版 C 编译器。Windows 平台比较流行的商业编译器是 Microsoft's Visual C++ 编译环境，同时支持 C 和 C++ 编译。（译者注：Visual Studio Express 版本也是免费的。）

#### 我们将从一个极其简单的 C 程序开始，并且本文假定我们已经在熟悉了 Unix 命令行并且使用 gcc 作为默认编译器。我们需要自己了解和熟悉自己喜欢的平台上面相应的其他主流编译器。

### 让我们开始吧！！！

## 最简单的 C 程序

#### 让我们从最简单的 C 程序开始并通过它来了解 C 和 C 程序编译流程。将下面的代码敲入一个编辑器（类 Unix 平台上 vim 或者 emacs，Windows 平台上 notepad.exe，Mac 平台上 TeachText）并保存为 __samp.c__。如果没有 .c 的后缀名，编译的时候可能会出现错误，所以不要忘记 .c 后缀名。
{% highlight c %}
#include <stdio.h>

int main()
{
    printf("This is output from my first program!\n");
    return 0;
}
{% endhighlight %}

#### 在执行上面代码的时候，计算机会打印出 “This is output from my first program!”，然后程序就会自动退出，就是这么简单。

##### 关于上面程序的一个示意图：
![C 程序的运行示意图][c-compile]

#### 编译过程包括下面这些步骤：
- 在类 Unix 平台上，在命令行中敲入下面的命令（如果 gcc 不工作，可以尝试 cc）。该命令调用 C 编译器 gcc 并让其编译 samp.c，将编译后的可执行文件命名为 samp，然后可以在命令行中敲入 ./samp （./ 表示当前目录）去运行该程序。

    gcc samp.c -o samp

- 在其他平台上，过程类似，请参考使用的编译器的说明。

## 最简单的 C 程序：发生了什么？

#### 我们来逐行看看上面的代码，了解每一行代码都做了些什么事：
- 这段程序第一行 “#include<stdio.h>” 引入了 “标准I/O库”。该库可以让程序从键盘输入（标准输入）中读入输入的字符并输出到屏幕（标准输出）上；处理存储在硬盘上的文件等等，所以是一个非常常用的库。C 拥有丰富的标准库，比如stdio，处理字符串（string）的库以及进行数学运算的库等。一个库就是其他人编写的用于实现特定功能的程序包，我们在文章后面还会谈到库。
- “int main()” 声明了主函数入口。所有 C 程序都必须有一个名字叫 __main__ 的函数。后面会更详细地介绍函数。运行的时候，程序会从 __main__ 函数的第一行代码开始执行。
- 在 C 程序中，__{__ 和 __}__ 符号包括了一个代码块，在这段程序中，__main__ 函数中的代码块包含了两行代码。
- C 语言中的 __printf__ 语句可以让我们输出内容到标准输出（这里指屏幕）。参数中双引号包含的部分称为 __格式化字符串__，并且描述了数据以何种格式显示。__格式化字符串__可以包含基本的字符串比如 “This is output from my first program!” 或者变量的占位符（下面马上会提到）。在类 Unix 系统上，在命令行中敲入 “man 3 printf” 可以看到关于该函数的详细文档，我们使用的编译器说明文档中也包含对于 C 标准库函数比如 printf 的说明文档。

## 变量

#### 作为一名程序员，我们经常会希望我们的程序记住一些值。比如，我们的程序从用户那里获取到一个值，或者经过一些计算得到了一些值，那我们一般需要暂时记录他们以便稍后使用。程序记录数据就是通过使用变量实现的。比如：

    int b;

#### 上面的代码表明 “我需要一个地方名字叫 __b__ 并且能保存一个整型数值”。一个变量拥有一个名字（这里就是 __b__）和一个类型（这里就是 __int__ 整型类型），然后我们就可以将一个整型数值保存到 __b__

    b = 5;

#### 我们可以通过这种方式使用变量 __b__：

    printf("%d", b);

#### 在 C 语言中，有下面这些标准类型：
- int —— 整型数
- long —— 长整型数
- float —— 浮点数
- char —— 单字符类型

#### 我们将在后面接触到其他类型。

## printf

#### __printf__ 语句让我们输出数据到标准输出。对我们来说，标准输出一般指的是屏幕，当然也可以是文件后者其他命令行进程。

#### 下面是一个关于 __printf__ 用法的例子：
{% highlight c %}
#include <stdio.h>

int main()
{
    int a, b, c;
    a = 5;
    b = 7;
    c = a + b;
    printf("%d + %d = %d\n", a, b, c);
    return 0;
}
{% endhighlight %}

#### 将上面的代码敲入编辑器并保存为名字为 add.c 的文件，使用 “gcc add.c -o add” 编译该文件，并使用 “./add” 运行该程序，我们会看到输出 “5 + 7 = 12”

#### 对这段程序的说明如下：
- “int a, b, c;” 声明了 3 个整型数变量，分别命名为a, b 和 c
- 下一行初始化变量 a 的值为 5
- 再下一行初始化 b 的值为 7
- 再下一行将 a 和 b 的值相加，并赋予变量 c。计算机会计算出 5 + 7 的值 12，将其保存到变量 c，“=” 在这里被称为赋值操作符。
- __printf__ 语句打印出 “5 + 7 = 12”，“%d” 是 __格式化字符串__ 中变量的占位符，本例中有 3 个，在 __格式化字符串__ 之后是 3 个变量的名字。 C 会将这些变量按照出现的顺序和 __格式化字符串__ 中的占位符对应。

## printf: 读取用户输入

#### 上一节的例子很好地演示了 __printf__ 函数的用法，但是如果我们不使用常量，而是从用户的键盘输入中获取 5 和 7 两个数据会更好一些，看看下面这段代码：
{% highlight c %}
#include <stdio.h>

int main()
{
    int a, b, c;
    printf("Enter the first value:");
    scanf("%d", &a);
    printf("Enter the second value:");
    scanf("%d", &b);
    c = a + b;
    printf("%d + %d = %d\n", a, b, c);
    return 0;
}
{% endhighlight %}

下面这张图演示了这段程序的运行情况：
![C 程序运行示意图][scanf sample]

#### 可以运行一下这段代码看看结果。这里需要注意的是： __scanf__ 和 __printf__ 函数使用了相同的 __格式化字符串__ 规则（在 Linux 系统中，可以在命令行中运行 “man scanf” 看到详细的用法介绍）。而且在 __scanf__ 函数使用时，变量 a 和 b 前面都有 __&__ 取地址操作符，该操作符可以返回变量在内存中的地址（我们在后面提到 __指针__ 的时候会阐述原理）。取地址操作符 __&__ 在这里是必须的，否则在运行时会报错。可以去掉它们运行看看报错信息是什么样子的。

#### 为了更全面地掌握 __printf__ 函数的用法，我们来看几个例子：

- 最简单的 __printf__ 函数用法：
{% highlight c %}
    //使用一个格式化字符串告诉 printf 函数将单词 "Hello" 发送到标准输出。
    printf("Hello");
{% endhighlight %}

- 加上换行之后：
{% highlight c %}
    //和上面的代码相比，下面的代码在输出 "Hello" 之后会紧跟一个换行，"\n" 是 ANSI 码中的换行符。
    printf("Hello\n");
{% endhighlight %}

- 输出变量的值：
{% highlight c %}
    //输出整型变量 b 的值。 __%d__ 是 __格式化字符串__ 中的占位符，在 __printf__ 函数运行时，其将被变量 b 的值替换
    printf("%d", b);
{% endhighlight %}

- 一个相对完整的用法：
{% highlight c %}
    printf("The temperature is %d degrees\n", b);
{% endhighlight %}

- 一个 __格式化字符串__ 可以有多个占位符：
{% highlight c %}
    printf("%d + %d = %d\n", a, b, c);
{% endhighlight %}

#### 在使用 __printf__ 函数时，保证 __格式化字符串__ 中的占位符数量和其后面的变量数量一致非常重要。这些变量会按照顺序在运行时依次替换 __格式化字符串__ 中的占位符。当然，我们还需要做的是保证这些变量的类型和占位符声明的类型一致。

#### 我们可以使用 __printf__ 函数打印所有 C 语言基本数据类型。
- __int__ - __%d__
- __float__ - __%f__
- __char__ - __%c__
- __字符数组__ - __%s__
- 在类 Unix 操作系统命令行中使用 “man printf” 可以得到 __printf__ 函数更详细的用法。

### 一些需要避免的 C 语言编程中的常见错误：
1. 使用了错误的大小写 - C 语言是大小写敏感的语言，sample 和 Sample 是不一样的名字。
2. 在 __scanf__ 函数中忘记了使用 __&__ 取地址操作符。
3. 在 __printf__ 或者 __scanf__ 函数使用时，在 __格式化字符串__ 后面跟着的变量数量和 __格式化字符串__ 中的占位符数量不一致。
4. 忘记在变量使用前对其进行声明。

## scanf

#### __scanf__ 函数让我们可以从标准输入接受数据。一般情况下标准输入指的是键盘输入。__scanf__ 函数可以用于简单的数据接收，对于用户的错误输入没有做验证，但是对于比较简单的程序已经足够好用。

- 最简单的 __scanf__ 函数用法：
{% highlight c %}
    //从用户键盘输入中读入一个整型数值并保存到变量 b
    scanf("%d", &b);
{% endhighlight %}

#### __scanf__ 函数的 __格式化字符串__ 和占位符用法和 __printf__ 函数是相同的：
- __int__ - __%d__
- __float__ - __%f__
- __char__ - __%c__
- __字符数组__ - __%s__

#### 需要特别注意的是：在使用 __scanf__ 函数时，我们必须在变量名前面加上取地址操作符 __&__ 。如果忘记会导致运行时错误。这里的原理在后面阐述指针的时候会介绍到。

#### 通常来说，使用 __scanf__ 函数应该就像这里的例子一样，简单明确：从键盘输入中获取用户输入并操作到变量中。对于多个值，可以多次调用 __scanf__ 函数。在实际的项目中，我们会使用 __gets__ 和 __fgets__ 函数从文件中逐行读取，然后再解析获取到的每一行数据来进一步获得里面的具体数据。这样做的原因是我们可以在这个过程中检测数据错误并进行相应的处理。

## 条件和循环

#### 在 C 编程语言中，__if__ 和 __while__ 语句都依赖于布尔表达式，这里有一段程序展示如何使用 __if__ 语句：
{% highlight c %}
#include <stdio.h>

int main() 
{ 
    int b; 
    printf("Enter a value:"); 
    scanf("%d", &b); 
    if (b < 0) 
        printf("The value is negativen"); 
    return 0; 
}
{% endhighlight %}

#### 这段代码从用户输入中接收一个数字，然后使用 __if__ 语句测试该数字是否小于零，如果是，程序会打印一段信息，否则，程序什么也不做。__(b < 0)__ 就是布尔表达式。C 程序将评估该表达式的值并确定是否打印一段信息。如果表达式为 __True__，紧跟 __if__ 语句的那一行代码会被执行。（如果需要执行多行代码，可以在 __if__ 语句后用大括号包含所有需要执行的代码）；如果该表达式的值为 __False__，紧跟在 __if__ 语句后的代码将被跳过。

#### 程序运行示意图：
![C 程序运行示意图][if_statement]

#### C 编程语言中使用 __==__ 符号来验证是否相等，使用 __=__ 来赋值；使用 __&&__ 进行[逻辑与判断][3]；使用 __||__ 进行逻辑或判断。

#### 这里是 C 编程语言中的所有的布尔逻辑操作符：
- equality          ==
- less than         <
- Greater than      >
- <=                <=
- >=                >=
- inequality        !=
- and               &&
- or                ||
- not               !

#### __while__ 语句的使用和 __if__ 语句一样简单：
{% highlight c %}
while (a < b)
{
    printf("%d\n", a);
    a = a + 1;
}
{% endhighlight %}

#### 这段程序中，大括号中的两行代码会一直重复执行直到变量 a 大于或者等于变量 b。示意图如下：
![while 语句运行示意图][while]

#### C 语言同时提供 __do-while__ 结构：
{% highlight c %}
do
{
    printf("%d\n", a);
    a = a + 1;
}
while(a < b)
{% endhighlight %}

#### 这段代码中，大括号中间的两行代码至少会执行一次，第一次执行完毕后会检查变量 a 的值是否小于变量 b 的值，如果不是则退出循环。

#### __for__ 循环是 __while__ 循环的另一种形式。如果我们有下面的 __while__ 语句：
{% highlight c %}
x=1;
while (x<10)
{
    blah blah blah
    x++; /* x++ is the same as saying x=x+1 */
}
{% endhighlight %}

#### 那我们就可以将其改写为：
{% highlight c %}
for(x=1; x<10; x++)
{
    blah blah blah
}
{% endhighlight %}

#### 在 __for__ 语句中，我们将变量初始化，变量变化和循环退出条件放在一起。

#### 再看个例子：
{% highlight c %}
a=1;
b=6;
while (a < b)
{
    a++;
    printf("%d\n",a);
}
{% endhighlight %}

#### 同样的，我们可以将其改写为：
{% highlight c %}
for (a=1,b=6; a < b; a++,printf("%d\n",a));
{% endhighlight %}

#### 看上去稍微有点复杂，但是也很直观。初始化部分的逗号可以让我们初始化多个变量，在变量变化区可以放入执行语句。这里的用法合法，但是不一定容易理解，所以比较通用的做法是把执行语句放于循环体中。

## 循环的例子

## 数组1

## 数组2

## 函数

## 函数：函数原型

## 库

## 创建库

## Makefiles

## 文件处理

## 文件处理 - 打开

## 文件处理 - 读取

## 指针

## 指针 - 为什么使用指针

## 指针 - 基础

## 指针 - 理解内存地址

## 指针 - 指向相同地址

## 指针 - 常见bug

## 指针 - 指针作为函数参数

## 动态数据结构

## 动态数据结构 - 堆

## 动态数据结构 - malloc 和 free

## 高级指针

## 指向结构体的指针

## 指向指针的指针

## 一个栈的例子

## 指针和数组

## 字符串

## 字符串 - 注意事项

## 操作符优先级

## 命令行参数

## 二进制文件

### TBF

[1]: http://computer.howstuffworks.com/
[2]: http://computer.howstuffworks.com/c23.htm/printable
[3]: http://computer.howstuffworks.com/boolean1.htm
[c-exec]: /images/c-exec.gif
[c-compile]: /images/c-compile.gif
[scanf sample]: /images/scanf_sample.gif
[if_statement]: /images/if_statement.gif
[while]: /images/c-while.gif


